# PROMPT AVANÃ‡ADO PARA TESTES E2E - COCOT ULTRA 2025

## ðŸš€ VisÃ£o EstratÃ©gica
**Objetivo PrimÃ¡rio**:  
Validar o sistema como um **produto finalizado**, simulando jornadas reais de usuÃ¡rios com **98% de fidelidade** aos cenÃ¡rios de produÃ§Ã£o.

## ðŸŒ Arquitetura de Teste
```mermaid
graph LR
    A[UI/CLI] --> B[API Gateway]
    B --> C[ServiÃ§o A]
    B --> D[ServiÃ§o B]
    C --> E[(Database)]
    D --> E
    C --> F[Filas]
    D --> G[Cache]

ðŸ§© TÃ©cnicas Essenciais
1. Page Objects Aprimorados (UI)

class CheckoutPage:
    def __init__(self, page):
        self.page = page
        self.cart_total = page.locator("#cart-total")
        self.pay_button = page.locator("#pay-now")

    def complete_purchase(self):
        self.pay_button.click()
        return OrderConfirmationPage(self.page)

# Uso no teste
def test_checkout_flow():
    checkout = CheckoutPage(page)
    confirmation = checkout.complete_purchase()
    assert confirmation.is_order_successful()

2. API Contract Validation

def test_api_contract():
    response = api.get("/orders/123")
    
    # Valida schema OpenAPI
    assert validate_schema(response.json(), "order_schema_v3.json")
    
    # Valida business rules
    assert response.json()["status"] in ["pending", "completed"]
    assert response.elapsed < timedelta(seconds=2)

3. Banco de Dados + UI Sync

def test_order_persistence():
    # 1. AÃ§Ã£o na UI
    ui.select_product("VIP-001")
    ui.checkout()
    
    # 2. VerificaÃ§Ã£o no banco
    db_order = database.query("SELECT * FROM orders WHERE id = '123'")
    assert db_order["status"] == "pending"
    
    # 3. Valida sincronizaÃ§Ã£o
    ui_status = ui.get_order_status("123")
    assert ui_status == db_order["status"]

âš¡ PadrÃµes AvanÃ§ados
1. Testes Multi-Camadas

def test_full_user_journey():
    # UI â†’ API â†’ DB â†’ Cache
    user.register_ui()           # Camada UI
    token = user.get_auth_api()  # Camada API
    assert db.has_user(token)    # Camada DB
    assert cache.is_valid(token) # Camada Cache

2. Visual Testing

def test_ui_layout():
    page.goto("/dashboard")
    
    # ValidaÃ§Ã£o visual com tolerÃ¢ncia de 2%
    assert screenshot_match(
        page,
        threshold=0.02,
        mask=[".temporary-banner"]  # Ignora elementos dinÃ¢micos
    )

3. Testes de ResiliÃªncia

def test_payment_retry_flow():
    with mock.patch("PaymentGateway.process", side_effect=[TimeoutError, True]):
        order = checkout(attempts=2)
        assert order.is_successful()
        assert mock.call_count == 2

ðŸ“Š Matriz de Cobertura
Fluxo	Prioridade	Camadas Envolvidas	CritÃ©rios de ÃŠxito
Checkout Completo	P0	UIâ†’APIâ†’DBâ†’Paymentâ†’Email	OrderID consistente em todos sistemas
Login SSO	P1	UIâ†’AuthAPIâ†’Cache	Session token vÃ¡lido por 24h
RelatÃ³rio Financeiro	P2	APIâ†’DBâ†’S3	PDF gerado com dados corretos
ðŸ” ValidaÃ§Ãµes Cruzadas

def test_cross_system_validation():
    # 1. AÃ§Ã£o no Sistema A
    sys_a.create_order()
    
    # 2. VerificaÃ§Ã£o no Sistema B
    sys_b_orders = external_api.get_orders()
    
    # 3. ValidaÃ§Ã£o consistente
    assert_order_sync(
        source=sys_a.last_order,
        target=sys_b_orders[-1],
        fields=["id", "total", "items"]
    )

ðŸ› ï¸ Template de SaÃ­da

## Teste Gerado: `test_checkout_completo.py`

**Fluxo Coberto**:  
"UsuÃ¡rio premium adiciona 3 itens, aplica cupom, finaliza com Pix"

**Camadas Validadas**:
1. UI: InteraÃ§Ã£o com carrinho
2. API: Chamadas ao serviÃ§o de preÃ§os
3. DB: PersistÃªncia do pedido
4. External: Gateway de pagamento

```python
# CÃ³digo do teste
def test_checkout_premium_pix():
    # ... implementaÃ§Ã£o ...

    # ... implementaÃ§Ã£o ...
Racional:

Cobrir cenÃ¡rio com 35% de ocorrÃªncia em produÃ§Ã£o

Validar integraÃ§Ã£o crÃ­tica com gateway Pix

Detectar regressÃµes no cÃ¡lculo de descontos


## ðŸš¨ Checklist de Qualidade
- [ ] 100% dos passos tÃªm assertions vÃ¡lidas
- [ ] 0 chamadas para `sleep()` ou waits estÃ¡ticos
- [ ] Todos os sistemas externos com timeouts configurados
- [ ] Dados de teste isolados e limpos apÃ³s execuÃ§Ã£o

# FIM DO PROMPT ULTRA-APRIMORADO

